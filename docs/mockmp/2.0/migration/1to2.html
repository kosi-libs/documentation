<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migrate MocKMP from 1.17 to 2.0 :: Kodein Open Source Initiative Documentation</title>
    <link rel="canonical" href="https://kosi-libs.org/mockmp/2.0/migration/1to2.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
      <nav class="navbar">
        <div class="navbar-brand">
          <a class="navbar-item" href="https://kosi-libs.org">
            <div class="navbar-brand-logo"></div>
            <div style="font-weight: 300;">Kodein Open Source Initiative</div>
          </a>
        </div>
        <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
            <a class="navbar-item" href="https://kodein.net" target="_blank">
              <div style="font-weight: 300;opacity:0.8;padding-right: 0.5rem">by</div>
              <div style="font-weight: 700;">KODEIN</div>
              <div style="font-weight: 300;opacity:0.8;">Koders</div>
            </a>
          </div>
        </div>
    </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mockmp" data-version="2.0">
  <aside class="nav">
    <div class="navbar-bottom-line-linear"></div>
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">MocKMP</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core/setup.html">Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core/mocking.html">Mocking interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core/facking.html">Faking concrete classes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core/injection.html">Injecting your test classes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core/helper.html">The test helper</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Migrations</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="1to2.html">1.17 to 2.0</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">MocKMP</span>
    <span class="version">2.0.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../canard/1.3/index.html">Canard</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../canard/1.3/index.html">1.3.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/1.2/index.html">1.2.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/1.1/index.html">1.1.1</a>
        </li>
        <li class="version">
          <a href="../../../canard/1.0/index.html">1.0.1</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.18/index.html">0.18.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.17/index.html">0.17.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.16/index.html">0.16.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.15/index.html">0.15.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.14/index.html">0.14.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.13/index.html">0.13.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.12/index.html">0.12.0</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.11/index.html">0.11.1</a>
        </li>
        <li class="version">
          <a href="../../../canard/0.10/index.html">0.10.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../kodein/7.25/index.html">Kodein</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../kodein/7.25/index.html">7.25.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.24/index.html">7.24.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.23/index.html">7.23.1</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.22/index.html">7.22.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.21/index.html">7.21.1</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.20/index.html">7.20.2</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.19/index.html">7.19.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.18/index.html">7.18.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.17/index.html">7.17.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.16/index.html">7.16.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.15/index.html">7.15.1</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.14/index.html">7.14.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.13/index.html">7.13.1</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.12/index.html">7.12.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.11/index.html">7.11.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.10/index.html">7.10.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.9/index.html">7.9.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.8/index.html">7.8.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.7/index.html">7.7.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.6/index.html">7.6.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.5/index.html">7.5.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.4/index.html">7.4.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.3/index.html">7.3.1</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.2/index.html">7.2.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.1/index.html">7.1.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/7.0/index.html">7.0.0</a>
        </li>
        <li class="version">
          <a href="../../../kodein/6.5/index.html">6.5.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../kosi-libs/index.html">Kodein Open Source Initiative</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../kosi-libs/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">MocKMP</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">2.0.0</a>
        </li>
        <li class="version">
          <a href="../../1.17/index.html">1.17.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="navbar-bottom-line-gradient"></div>
  <div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../kosi-libs/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">MocKMP</a></li>
    <li>Migrations</li>
    <li><a href="1to2.html">1.17 to 2.0</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.0.0</button>
  <div class="version-menu">
    <a class="version is-current" href="1to2.html">2.0.0</a>
    <a class="version is-missing" href="../../1.17/index.html">1.17.0</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/kosi-libs/MocKMP/edit/2.0/doc/modules/migration/pages/1to2.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Migrate MocKMP from 1.17 to 2.0</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The new MocKMP 2 changes the way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is configured in your project.</p>
</li>
<li>
<p>How mocks, fakes, and injectors are accessed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rest is the same: how mocks are configured and verified, as well as how fakes and injectors work, remains unchanged.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_build_script"><a class="anchor" href="#_gradle_build_script"></a>Gradle build script</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Using the MocKMP Gradle plugin is now the only way to use MocKMP in your project.
It is no longer possible to install it manually on your project without using the Gradle plugin.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_add_the_ksp_plugin"><a class="anchor" href="#_add_the_ksp_plugin"></a>Add the KSP plugin</h3>
<div class="paragraph">
<p>The MocKMP plugin does not apply the KSP plugin anymore.
You therefore need to add the KSP plugin according to the Kotlin version you are using:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">plugins {
    kotlin("multiplatform") version "2.0.21"
    id("com.google.devtools.ksp") version "2.0.21-1.0.28" <i class="conum" data-value="1"></i><b>(1)</b>
    id("org.kodein.mock.mockmp") version "2.0.0"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adding the KSP plugin in addition to the MocKMP plugin is now mandatory.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_the_mockmp_block_to_the_new_syntax"><a class="anchor" href="#_migrate_the_mockmp_block_to_the_new_syntax"></a>Migrate the <code>mockmp</code> block to the new syntax</h3>
<div class="paragraph">
<p><strong>After defining the Kotlin targets</strong>, migrate to the new MocKMP configuration.</p>
</div>
<div class="paragraph">
<p>The minimum required to activate MocKMP on your test source sets is:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">mockmp {
    onTest()
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>installWorkaround()</code> has been removed, as it was replaced by the <code>onTest</code> &amp; <code>onMain</code> functions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using the <code>TestWithMocks</code> helper class (or <code>ITestWithMocks</code> helper interface), add it to dependencies:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">mockmp {
    onTest {
        withHelper() <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that you can <a href="../core/setup.html#junit-version" class="xref page">specify which JUnit version</a> you are using (instead of relying on detection).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To see additional configuration options, as well as how to apply MocKMP to the main source sets, have a look at <a href="../core/setup.html" class="xref page">the setup documentation</a> .</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kotlin_sources"><a class="anchor" href="#_kotlin_sources"></a>Kotlin sources</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MocKMP 1 ran the code generation on JVM only and used generated code on all targets.
MocKMP 2 now runs the code generator individually on each target.
Because of this, it is not possible anymore to access mock classes &amp; fake creator functions by generated name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MocKMP 2 introduces accessor functions that are accessible from common sources.</p>
</div>
<div class="sect2">
<h3 id="_migrate_mock_classes_to_the_new_accessor"><a class="anchor" href="#_migrate_mock_classes_to_the_new_accessor"></a>Migrate mock classes to the new accessor</h3>
<div class="paragraph">
<p>Update your mock creation from <code>MockX(mocker)</code> to <code>mocker.mock&lt;X&gt;()</code>:</p>
</div>
<div class="listingblock">
<div class="title">MyTest.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface Validator {
    // ...
}

@UsesMocks(Validator::class)
class ValidatorTests : TestsWithMocks() {
    @Test
    fun testSimpleValidation() {
        // val validator = MockValidator(mocker) <i class="conum" data-value="1"></i><b>(1)</b>
        val validator = mocker.mock&lt;Validator&gt;() <i class="conum" data-value="2"></i><b>(2)</b>

        // ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Old syntax, not supported anymore as <code>MockFoo</code> is not in common sources anymore (but generated for each target).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>New syntax.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>Mocker.mock&lt;T&gt;</code> extension function is generated by MocKMP and will not be available before first build.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_fake_functions_to_the_new_accessor"><a class="anchor" href="#_migrate_fake_functions_to_the_new_accessor"></a>Migrate fake functions to the new accessor</h3>
<div class="paragraph">
<p>Update your fake creation from <code>fakeX()</code> to <code>fake&lt;X&gt;()</code>:</p>
</div>
<div class="listingblock">
<div class="title">MyTest.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">data class User(
    val id: Long,
    val name: String,
    //...
)

@UsesFakes(User::class)
class DatabaseTests {
    @Test
    fun testSave() {
        // val user = fakeUser() <i class="conum" data-value="1"></i><b>(1)</b>
        val user = fake&lt;User&gt;() <i class="conum" data-value="2"></i><b>(2)</b>

        database.save(user)

        // ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Old syntax, not supported anymore as <code>fakeUser</code> is not in common sources anymore (but generated for each target).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>New syntax.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>fake&lt;T&gt;</code> function is generated by MocKMP and will not be available before first build.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_injection_to_the_new_accessor"><a class="anchor" href="#_migrate_injection_to_the_new_accessor"></a>Migrate injection to the new accessor</h3>
<div class="paragraph">
<p>Update mocks &amp; fakes injections from <code>receiver.injectMocks(mocker)</code> to <code>mocker.injectMocks(receiver)</code>:</p>
</div>
<div class="listingblock">
<div class="title">MyTest.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class DatabaseTests : TestsWithMocks() {
    @Mock lateinit var validator: Validator
    @Fake lateinit var user: User

    // override fun setUpMocks() = injectMocks(mocker) <i class="conum" data-value="1"></i><b>(1)</b>
    override fun setUpMocks() = mocker.injectMocks(this) <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Old syntax, not supported anymore as <code>T.injectMocks(Mocker)</code> is not in common sources anymore (but generated for each target).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>New syntax.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>Mocker.injectMocks&lt;T&gt;</code> extension function is generated by MocKMP and will not be available before first build.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
<!--  <p>This page was built using the Antora default UI.</p>-->
<!--  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>-->
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
